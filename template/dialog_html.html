<!DOCTYPE html>
<html lang="ru">

<head>
    <meta http-equiv="content-type" content="text/html; charset=UTF-8">
    <meta charset="UTF-8">
    <title>VkHidden</title>
    <link href="{{ url_for('css', path='/normal.css') }}" rel="stylesheet">
    <link href="{{ url_for('css', path='/index_style.css') }}" rel="stylesheet">
    <script src="{{ url_for('js', path='/main.js') }}"></script>


    <script>

        window.onload = async function () {
            let end = document.getElementById("end")
            end.scrollIntoView()

            let response = await fetch("http://localhost:8080/key_exists", {
                "method": "POST",
                "mode": "cors",
                "headers": {
                    "Content-Type": "application/json"
                }
            },)

            if (response.ok) {
                let key_exists = await response.text()
                window.key_exists = Number(key_exists)
                if (Number(key_exists) == 400) {
                    alert("Для расшифровки сообщении необходимо создать ключ шифрования")
                }

            }
        }

    </script>

</head>

<body onclick="checkIsMessage(this)">
    <div class=" main">
        <div class="container">
            <div class="left_side">
                <div class="left_side_inner">
                    <svg width="20" height="20" class="vk_icon" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
                        <g id="message_outline_20__Page-2" stroke="none" stroke-width="1" fill="none"
                            fill-rule="evenodd">
                            <g id="message_outline_20__message_outline_20">
                                <path id="message_outline_20__Shape" opacity=".4" d="M0 0h20v20H0z"></path>
                                <path
                                    d="M6.83 15.75c.2-.23.53-.31.82-.2.81.3 1.7.45 2.6.45 3.77 0 6.75-2.7 6.75-6s-2.98-6-6.75-6S3.5 6.7 3.5 10c0 1.21.4 2.37 1.14 3.35.1.14.16.31.15.49-.04.76-.4 1.78-1.08 3.13 1.48-.11 2.5-.53 3.12-1.22ZM3.24 18.5a1.2 1.2 0 0 1-1.1-1.77A10.77 10.77 0 0 0 3.26 14 7 7 0 0 1 2 10c0-4.17 3.68-7.5 8.25-7.5S18.5 5.83 18.5 10s-3.68 7.5-8.25 7.5c-.92 0-1.81-.13-2.66-.4-1 .89-2.46 1.34-4.35 1.4Z"
                                    id="message_outline_20__Icon-Color" fill="currentColor" fill-rule="nonzero"></path>
                            </g>
                        </g>
                    </svg>
                    <a href="http:/main" class="menu_btn">Сообщения</a>
                </div>
                <div class="left_side_inner">
                    <svg fill="none" height="20" class="vk_icon" viewBox="0 0 20 20" width="20"
                        xmlns="http://www.w3.org/2000/svg">
                        <g fill="currentColor">
                            <g clip-rule="evenodd" fill-rule="evenodd">
                                <path
                                    d="M6.25 3.5a3 3 0 1 0 0 6 3 3 0 0 0 0-6zm-1.5 3a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0zm-2.06 5.07c.96-.55 2.22-.82 3.56-.82s2.6.27 3.56.82c.98.56 1.69 1.47 1.69 2.68 0 .7-.28 1.3-.78 1.71-.48.39-1.1.54-1.72.54H3.5c-.61 0-1.24-.15-1.72-.54-.5-.4-.78-1-.78-1.71 0-1.21.71-2.12 1.69-2.68zm.75 1.3c-.65.37-.94.84-.94 1.38 0 .3.1.44.22.54.14.11.4.21.78.21H9c.39 0 .64-.1.78-.21.12-.1.22-.25.22-.54 0-.54-.29-1-.94-1.38-.66-.39-1.65-.62-2.81-.62s-2.15.23-2.81.62zM13.75 3.5a3 3 0 1 0 0 6 3 3 0 0 0 0-6zm-1.5 3a1.5 1.5 0 1 0 3 0 1.5 1.5 0 0 0-3 0z">
                                </path>
                            </g>
                            <path
                                d="M13.75 12.25c-.23 0-.45.01-.68.03a.75.75 0 1 1-.14-1.49c.27-.03.54-.04.82-.04 1.34 0 2.6.27 3.56.82.98.56 1.69 1.47 1.69 2.68 0 .7-.28 1.3-.78 1.71-.48.39-1.1.54-1.72.54h-3a.75.75 0 0 1 0-1.5h3c.39 0 .64-.1.78-.21.12-.1.22-.25.22-.54 0-.54-.29-1-.94-1.38a5.77 5.77 0 0 0-2.81-.62z">
                            </path>
                        </g>
                    </svg>
                    <a href="#" class="menu_btn">Друзья</a>
                </div>
                <div class="left_side_inner">
                    <a href="#" class="create_key" onclick="createKey(this)">Создать ключ шифрования</a>
                </div>
                <div class="left_side_inner">
                    <a href="#" class="exit_vk" onclick="exitVK(this)">Выйти</a>
                </div>
            </div>
            <div class="right_side_inner_content" id="all_content">
                {% for content_data in data %}
                <div class="content" id="{{ content_data['message_id'] }}" onclick="selectMessage(this)">
                    <div class="inner_left">
                        <img src="{{ content_data['image'] }}" alt="" class="diaglog_img">
                    </div>

                    <div class="inner_right">
                        <p class="name">{{content_data["name"]}}</p>
                        <p id="message_id_text" class="message">{{content_data["text"]}}</p>
                    </div>

                </div>

                {% endfor %}
                <div id="end"></div>
            </div>
            <div class="btn_side">
                <input type="submit" value="Расшифровать" disabled id="decrypt_btn" onclick="decryptMessage()">
                <input type="submit" value="Зашифровать" disabled>
            </div>
            <div class="send_msg_block">

                <input class="send_msg_text" type="text" name="E" id="msg_text_filed" onkeydown="sendMessage(this)">
                <input class="send_msg_btn" type="button" value="Отправить" id="send_msg_btn" onclick="sendMessage(this)">
                <input type="checkbox" id="crypt_checkbox">
                <label for="crypt_checkbox">Шифровать</label>

            </div>
            <div id="end"></div>
        </div>
    </div>


</body>

</html>